# ================================
# PDF Generation Service - Production Configuration
# ================================
# IMPORTANT: Copy this file to .env.production and update all values
# NEVER commit .env.production to version control!

# ================================
# Server Configuration
# ================================
PORT=3001
NODE_ENV=production
HOST=0.0.0.0

# ================================
# PDF Service Configuration
# ================================

# Worker Thread Pool Settings
# Adjust based on your CPU cores (use 50-75% of available cores)
# Example: 8 cores = MIN:4, MAX:6 | 16 cores = MIN:8, MAX:12
PDF_MIN_THREADS=8
PDF_MAX_THREADS=16
PDF_CONCURRENT_TASKS=1

# Queue Settings
# Increase for high-traffic applications
PDF_MAX_QUEUE=1000
PDF_QUEUE_WARNING=800

# Timeout Settings (in milliseconds)
# Increase if generating complex PDFs
PDF_TASK_TIMEOUT=45000
PDF_IDLE_TIMEOUT=300000

# Retry Configuration
PDF_MAX_RETRIES=3
PDF_RETRY_DELAY=1000
PDF_RETRY_BACKOFF=1.5

# Recovery Settings - KEEP ENABLED
PDF_ENABLE_RECOVERY=true
PDF_RECOVERY_INTERVAL=5000

# Hang Detection - KEEP ENABLED
PDF_ENABLE_HANG_DETECTION=true
PDF_HANG_INTERVAL=10000
PDF_HANG_THRESHOLD=60000
PDF_WORKER_TERM_TIMEOUT=5000

# Worker Warmup
PDF_WARMUP=true

# PDF Service Logging
PDF_ENABLE_LOGGING=true

# ================================
# Request Tracking
# ================================
TRACKER_MAX_RETRIES=3
TRACKER_RETRY_DELAY=1000
TRACKER_TIMEOUT=30000
TRACKER_LOGGING=true

# ================================
# Dead Letter Queue
# ================================
DLQ_MAX_SIZE=1000
DLQ_LOGGING=true

# ================================
# Security Configuration
# ================================

# JWT Authentication
# REQUIRED: Generate with: openssl rand -base64 32
# NEVER use a weak or default secret in production!
JWT_SECRET=REPLACE-WITH-SECURE-RANDOM-KEY-MINIMUM-32-CHARACTERS
JWT_EXPIRES_IN=24h

# CORS Settings
# REQUIRED: Replace with your actual domain(s)
# For multiple domains: https://app.yourdomain.com,https://admin.yourdomain.com
CORS_ORIGIN=https://yourdomain.com
CORS_CREDENTIALS=false

# Request Body Limits
JSON_LIMIT=1mb

# Content Security Policy
CSP_ENABLED=true

# ================================
# Rate Limiting - ENABLE IN PRODUCTION
# ================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW=60000
RATE_LIMIT_MAX=100
RATE_LIMIT_MESSAGE=Too many requests, please try again later
RATE_LIMIT_HEADERS=true
RATE_LIMIT_LEGACY=false

# ================================
# Monitoring & Observability
# ================================

# Metrics & Health Checks - ENABLE FOR PRODUCTION
ENABLE_METRICS=true
METRICS_PATH=/metrics
HEALTH_PATH=/health

# Debug Mode - DISABLE IN PRODUCTION
DEBUG_STATS=false
ENABLE_DEBUG_ENDPOINTS=false

# Stats Logging Interval (ms)
STATS_INTERVAL=60000

# ================================
# Logging Configuration
# ================================

# Log Level: error, warn, info, debug
# Production: Use 'warn' or 'error' to reduce noise
LOG_LEVEL=warn

# Log Format: json (recommended for production)
LOG_FORMAT=json

# Console Logging
LOG_CONSOLE=true

# File Logging - ENABLE FOR PRODUCTION
LOG_FILE=true
LOG_FILE_PATH=/var/log/pdfgen/app.log
LOG_ERROR_PATH=/var/log/pdfgen/error.log

# ================================
# Performance Optimization
# ================================

# Response Compression - ENABLE FOR PRODUCTION
ENABLE_COMPRESSION=true
COMPRESSION_THRESHOLD=1024

# Template Caching - ENABLE FOR PRODUCTION
ENABLE_TEMPLATE_CACHE=true
TEMPLATE_CACHE_MAX=500
TEMPLATE_CACHE_TTL=7200000

# Automatic Garbage Collection - ENABLE FOR PRODUCTION
# REQUIRES: node --expose-gc flag
AUTO_GC=true
GC_INTERVAL=30000
GC_THRESHOLD=80
GC_MIN_FREED=50

# ================================
# Server Timeouts & Connection Settings
# ================================

# Timeouts (in milliseconds)
SERVER_KEEPALIVE_TIMEOUT=61000
SERVER_HEADERS_TIMEOUT=62000
SERVER_REQUEST_TIMEOUT=30000
SERVER_TIMEOUT=0

# Connection Limits
SERVER_MAX_CONNECTIONS=10000

# Socket Settings
SOCKET_NO_DELAY=true
SOCKET_KEEP_ALIVE=true
SOCKET_KEEPALIVE_DELAY=60000
SOCKET_WRITE_BUFFER=262144

# ================================
# Graceful Shutdown
# ================================
SHUTDOWN_TIMEOUT=10000
ENABLE_GRACEFUL_SHUTDOWN=true

# ================================
# Data & API Configuration
# ================================
MOCK_DATA_PATH=./src/data/opd-data.json
ENABLE_MOCK_DATA=false

# ================================
# Production Deployment Checklist
# ================================
# Before deploying to production:
#
# 1. Security:
#    ✓ Set JWT_SECRET to a strong random value
#    ✓ Set CORS_ORIGIN to your specific domain
#    ✓ Enable RATE_LIMIT_ENABLED=true
#    ✓ Set CSP_ENABLED=true
#    ✓ Disable ENABLE_DEBUG_ENDPOINTS
#
# 2. Performance:
#    ✓ Enable ENABLE_COMPRESSION=true
#    ✓ Enable ENABLE_TEMPLATE_CACHE=true
#    ✓ Enable AUTO_GC=true (with --expose-gc)
#    ✓ Adjust thread counts for your CPU
#
# 3. Monitoring:
#    ✓ Enable ENABLE_METRICS=true
#    ✓ Enable LOG_FILE=true
#    ✓ Set appropriate LOG_LEVEL
#    ✓ Configure log file paths
#
# 4. Infrastructure:
#    ✓ Set up reverse proxy (nginx/Caddy)
#    ✓ Configure SSL/TLS certificates
#    ✓ Set up process manager (PM2/systemd)
#    ✓ Configure monitoring/alerting
#    ✓ Set up log rotation
#    ✓ Test with realistic load
#
# ================================
